-- Bảng Users (Người dùng/Nhân viên)
CREATE TABLE Users (
    UserID VARCHAR(10) PRIMARY KEY,
    Username VARCHAR(50) NOT NULL UNIQUE,
    Password VARCHAR(100) NOT NULL,
    FullName VARCHAR(100) NOT NULL, 
    Email VARCHAR(100),
    Phone VARCHAR(20),
    Role VARCHAR(20) NOT NULL, 
    Status VARCHAR(20) DEFAULT 'Active',
    CreatedAt TIMESTAMP WITHOUT TIME ZONE DEFAULT NOW(), 
    LastLogin TIMESTAMP WITHOUT TIME ZONE
);

---

-- Bảng RoomTypes (Loại phòng)
CREATE TABLE RoomTypes (
    TypeID VARCHAR(10) PRIMARY KEY,
    TypeName VARCHAR(50) NOT NULL, 
    Description TEXT,              
    BasePrice NUMERIC(10,2) NOT NULL, 
    Capacity INT NOT NULL,
    Amenities TEXT                     
);

-- Bảng Rooms (Phòng)
CREATE TABLE Rooms (
    RoomID VARCHAR(10) PRIMARY KEY,
    RoomNumber VARCHAR(10) NOT NULL UNIQUE,
    TypeID VARCHAR(10) REFERENCES RoomTypes(TypeID),
    Floor INT NOT NULL,
    Status VARCHAR(20) DEFAULT 'Available',
    Notes TEXT,                     
    LastCleaned TIMESTAMP WITHOUT TIME ZONE 
);

-- Bảng Guests (Khách hàng)
CREATE TABLE Guests (
    GuestID VARCHAR(10) PRIMARY KEY,
    FullName VARCHAR(100) NOT NULL, 
    IDNumber VARCHAR(20) NOT NULL,
    Email VARCHAR(100),
    Phone VARCHAR(20) NOT NULL,
    Address VARCHAR(200),           
    GuestType VARCHAR(20) DEFAULT 'Regular',
    TotalStays INT DEFAULT 0,
    TotalSpent NUMERIC(10,2) DEFAULT 0, 
    CreatedAt TIMESTAMP WITHOUT TIME ZONE DEFAULT NOW()
);

-- Bảng ServiceCategories (Danh mục dịch vụ)
CREATE TABLE ServiceCategories (
    CategoryID VARCHAR(10) PRIMARY KEY,
    CategoryName VARCHAR(50) NOT NULL,  
    Description VARCHAR(200)            
);

-- Bảng Services (Dịch vụ)
CREATE TABLE Services (
    ServiceID VARCHAR(10) PRIMARY KEY,
    CategoryID VARCHAR(10) REFERENCES ServiceCategories(CategoryID),
    ServiceName VARCHAR(100) NOT NULL,  
    Description TEXT,                   
    Price NUMERIC(10,2) NOT NULL,       
    RequireBooking BOOLEAN DEFAULT FALSE,
    AvailableInRoom BOOLEAN DEFAULT FALSE,  
    Status VARCHAR(20) DEFAULT 'Active'
);

-- Bảng Bookings (Đặt phòng)
CREATE TABLE Bookings (
    BookingID VARCHAR(10) PRIMARY KEY,
    GuestID VARCHAR(10) REFERENCES Guests(GuestID),
    RoomID VARCHAR(10) REFERENCES Rooms(RoomID),
    CheckInDate DATE NOT NULL,
    CheckOutDate DATE NOT NULL,
    Adults INT NOT NULL,
    Children INT DEFAULT 0,
    Status VARCHAR(20) DEFAULT 'Pending',
    TotalAmount NUMERIC(10,2),          
    Deposit NUMERIC(10,2) DEFAULT 0,    
    Notes TEXT,                         
    CreatedBy VARCHAR(10) REFERENCES Users(UserID),
    CreatedAt TIMESTAMP WITHOUT TIME ZONE DEFAULT NOW(),
    ModifiedAt TIMESTAMP WITHOUT TIME ZONE
);
-- Bảng BookingServices (Dịch vụ đi kèm đặt phòng)
CREATE TABLE BookingServices (
    BookingID VARCHAR(10) REFERENCES Bookings(BookingID),
    ServiceID VARCHAR(10) REFERENCES Services(ServiceID),
    Quantity INT DEFAULT 1,
    Price NUMERIC(10,2) NOT NULL,       
    TotalAmount NUMERIC(10,2),          
    ServiceDate TIMESTAMP WITHOUT TIME ZONE,
    Status VARCHAR(20) DEFAULT 'Pending',
    Notes VARCHAR(200),                 
    PRIMARY KEY (BookingID, ServiceID)
);

-- Bảng Payments (Thanh toán)   
CREATE TABLE Payments (
    PaymentID VARCHAR(10) PRIMARY KEY,
    BookingID VARCHAR(10) REFERENCES Bookings(BookingID),
    Amount NUMERIC(10,2) NOT NULL,      
    PaymentMethod VARCHAR(50) NOT NULL,
    PaymentDate TIMESTAMP WITHOUT TIME ZONE DEFAULT NOW(),
    Status VARCHAR(20) DEFAULT 'Completed',
    Notes VARCHAR(200),                 
    ProcessedBy VARCHAR(10) REFERENCES Users(UserID)
);

-- Bảng Maintenance (Bảo trì phòng)
CREATE TABLE Maintenance (
    MaintenanceID VARCHAR(10) PRIMARY KEY,
    RoomID VARCHAR(10) REFERENCES Rooms(RoomID),
    Description TEXT NOT NULL,          
    StartDate TIMESTAMP WITHOUT TIME ZONE NOT NULL,
    EndDate TIMESTAMP WITHOUT TIME ZONE,
    Status VARCHAR(20) DEFAULT 'Pending',
    Cost NUMERIC(10,2),                 
    Notes VARCHAR(200),                 
    RequestedBy VARCHAR(10) REFERENCES Users(UserID),
    CompletedBy VARCHAR(10) REFERENCES Users(UserID)
);